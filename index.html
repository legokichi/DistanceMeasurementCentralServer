<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Markdown to Reveal.js</title>
    <meta name="description" content="">
    <meta name="author" content="">
    <meta name="apple-mobile-web-app-capable" content="yes" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/reveal.min.css"/>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/css/theme/white.min.css"/>
    <!--link rel="stylesheet" type="text/css" href="../github-markdown.css" /-->
    <style media="screen">
      img{border:none !important;}
      h1,h2,h3,h4,h5{
        word-break: keep-all;
        text-transform: none !important;
      }
    </style>
  </head>
  <body>
    <div class="reveal">
      <div class="slides markdown-body">
        <section
         data-markdown
         data-separator="^---\n"
         data-separator-vertical="^\n\n"
         data-separator-notes="^Note:"
         data-charset="utf-8">
        </section>
      </div>
    </div>
    <script type="text/x-mathjax-config">
      MathJax.Hub.Config({
        skipStartupTypeset: true,
        extensions: ["tex2jax.js"],
        jax: ["input/TeX", "output/HTML-CSS"],
        tex2jax: {
          inlineMath: [ ['$','$'], ["\\(","\\)"] ],
          displayMath: [ ['$$','$$'], ["\\[","\\]"] ],
          processEscapes: true
        },
        "HTML-CSS": {
          availableFonts: ["TeX"]
        },
        "TeX": {
          extensions: [
            "AMSmath.js",
            "AMSsymbols.js",
            "http://www.duxca.com/xypic.js"
          ]
        }
      });
    </script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.5.3/MathJax.js?config=TeX-AMS-MML_HTMLorMML&delayStartupUntil=configured"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/lib/js/head.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/js/reveal.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0-alpha1/jquery.min.js"></script>
    <script>
      window.addEventListener("DOMContentLoaded", main);
      var get = $.get;
      MathJax.Hub.Configured();

      function main(){
        var name = "";
        if( location.search.length <= 1 ){
          name = "index.md";
          location.search = "?" + name;
        }else{
          name = location.search.slice(1);
        }
        get(name).catch(function(){
          return "# 404 page not found";
        }).then(function(text){
          var PREFIX = "\n<pre><code class=\"lang-math\">";
          var SUFFIX = "</code></pre>\n";
          var reg = /\$\$([\s\S]+?)\$\$/gm;
          var tuple = null;
          var _text = text;
          while(tuple = reg.exec(text)){
            _text = _text.replace(tuple[0], PREFIX + tuple[1] + SUFFIX);
          }
          return _text;
        }).then(function(text){
          var PREFIX = "<span class=\"lang-math-inline\">```";
          var SUFFIX = "```</span>";
          var reg = /\$([^\r\n]+?)\$/g;
          var _text = text;
          var tuple = null;
          while(tuple = reg.exec(text)){
            _text = _text.replace(tuple[0], PREFIX + tuple[1] + SUFFIX);
          }
          return _text;
        }).then(function(text){
          console.log(name);
          text = "<base href='"+name+"' />\n\n" + text;
          $(document.createElement("script"))
          .attr("type", "text/template").html(text)
          .appendTo($("section[data-markdown]"));

          // Full list of configuration options available here:
          // https://github.com/hakimel/reveal.js#configuration
          Reveal.initialize({
            controls: true,
            progress: true,
            history: true,
            center: true,
            slideNumber: true,
            theme: Reveal.getQueryHash().theme, // available themes are in /css/theme
            transition: Reveal.getQueryHash().transition || 'default', // default/cube/page/concave/zoom/linear/fade/none
            dependencies: [
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/lib/js/classList.js', condition: function() { return !document.body.classList; } },
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/markdown/marked.min.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/markdown/markdown.min.js', condition: function() { return !!document.querySelector( '[data-markdown]' ); } },
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/highlight/highlight.js', async: true, callback: function() { hljs.initHighlightingOnLoad(); } },
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/zoom-js/zoom.js', async: true, condition: function() { return !!document.body.classList; } },
              { src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/notes/notes.js', async: true, condition: function() { return !!document.body.classList; } },
              //{ src: 'https://cdnjs.cloudflare.com/ajax/libs/reveal.js/3.2.0/plugin/math/math.js', async: true }
            ]
          });
          Reveal.addEventListener( 'ready', function( event ) {
            $(".lang-math-inline").map(function(i, elm){
              var code = $(elm).children().html()
                .replace(/\&amp;/g, "&")
                .replace(/\&lt;/g, "<")
                .replace(/\&gt;/g, ">");
              $(elm).after("$" + code + "$").remove();
            });
            $(".lang-math").map(function(i, elm){
              var code = $(elm).html()
                .replace(/\&amp;/g, "&")
                .replace(/\&lt;/g, "<")
                .replace(/\&gt;/g, ">");
              $(elm).parent().after("$$" + code + "$$").remove();
            });
            MathJax.Hub.Queue(["Typeset", MathJax.Hub, document.body]);
          });
        }).catch(function(err){
          console.error(err, err.stack);
        });
      }


    </script>
  </body>
</html>
